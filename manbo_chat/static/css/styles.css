/* 基础布局与自适应 */
:root {
  --bg: #7d8592;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #7c8a9a;
  --primary: #56637a;
  --danger: #b23b3b;
  --border: #e5e7eb;
}
* { box-sizing: border-box; }
html, body { height: 100%; }
body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif; color: var(--text); }

/* Login */
.login-bg { background: radial-gradient(ellipse at top left, #8b919e, #6f7683); display: grid; place-items: center; padding: 24px; }
.card { background: var(--card); border-radius: 16px; padding: 32px; width: min(640px, 92vw); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
.title { font-size: 36px; font-weight: 800; text-align: center; margin: 0 0 8px; }
.subtitle { text-align: center; color: var(--muted); margin: 0 0 24px; }
.form-item { margin-bottom: 16px; }
.input-icon { display: flex; align-items: center; gap: 8px; border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; background: #f9fafb; }
.input-icon .icon { opacity: .6; }
.input-icon input, .input-icon select { flex: 1; border: none; outline: none; background: transparent; font-size: 16px; padding: 8px 4px; }
.btn { border: none; border-radius: 10px; padding: 10px 16px; background: #eef2f7; color: var(--text); cursor: pointer; }
.btn.primary { background: var(--primary); color: #fff; }
.btn.danger { background: var(--danger); color: #fff; }
.btn:active { transform: translateY(1px); }
.tip { color: #b45309; min-height: 22px; }

/* Chat */
.chat-bg { background: #7d8592; min-height: 100%; display: grid; grid-template-rows: auto 1fr; }
.chat-header { background: #fff; display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; box-shadow: 0 2px 8px rgba(0,0,0,.08); }
.chat-title { font-weight: 800; font-size: 22px; letter-spacing: .5px; }
.chat-actions { display: flex; gap: 8px; }
.chat-main { display: grid; grid-template-rows: 1fr auto; width: min(1100px, 96vw); margin: 20px auto; background: #fff; border-radius: 14px; box-shadow: 0 8px 20px rgba(0,0,0,.12); }
.message-list { padding: 16px; overflow-y: auto; min-height: 0; }
.chat-input { border-top: 1px solid var(--border); padding: 12px; }
.toolbar { display: flex; gap: 8px; align-items: center; }
.toolbar .tips { color: var(--muted); font-size: 12px; margin-left: auto; text-align: right; flex: 1 1 auto; white-space: nowrap; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; }
.input-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; margin-top: 8px; }
#msgInput { border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; font-size: 16px; }
#sendBtn { white-space: nowrap; }

/* 消息气泡 */
.message { display: flex; gap: 10px; margin: 8px 0; align-items: flex-start; }
.avatar { width: 36px; height: 36px; border-radius: 50%; background: #e5e7eb; display: grid; place-items: center; font-size: 18px; }
.bubble { max-width: 100%; display: inline-block; padding: 12px 14px; border-radius: 14px; box-shadow: 0 2px 6px rgba(0,0,0,.05); white-space: pre-wrap; word-break: break-word; line-height: 1.6; }
.message.me .bubble { background: #e8f0ff; margin-left: auto; border: 1px solid #dbeafe; }
.message.other .bubble { background: #f4f5f7; border: 1px solid #e5e7eb; }
.message.system { justify-content: center; }
.message.system .bubble { background: #fffceb; color: #92400e; }
.meta { font-size: 12px; color: var(--muted); margin-top: 4px; }

/* 响应式 */
@media (max-width: 520px) {
  .title { font-size: 28px; }
  .bubble { max-width: 100%; }
}

/* ---- 新增：两列布局与侧栏样式 ---- */
.chat-main { grid-template-columns: 260px 1fr; }
.sidebar { border-right: 1px solid var(--border); padding: 12px; overflow: hidden; display: flex; flex-direction: column; gap: 10px; }
.sidebar .contacts-header { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
.sidebar input { border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px; }
.contacts-list { display: flex; flex-direction: column; gap: 6px; flex: 1 1 auto; overflow-y: auto; min-height: 0; }
.contact-item { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 10px; background: #f8fafc; cursor: pointer; }
.contact-item.active { background: #e8f0ff; }
.contact-item .avatar { width: 28px; height: 28px; font-size: 14px; }
.sidebar-footer { margin-top: auto; padding-top: 8px; border-top: 1px dashed var(--border); color: var(--muted); font-size: 12px; line-height: 1.6; }
.sidebar-footer small { display: block; white-space: normal; overflow-wrap: anywhere; }
/* 让气泡根据内容自适应宽度 */
.bubble { display: inline-block; word-break: break-word; }

/* 保持只有消息区滚动（调整为不裁剪emoji面板） */
.sidebar { overflow: visible; }
.chat-header { overflow: hidden; }
.chat-input { overflow: visible; }
/* 气泡尾巴与更优的层次表现 */
.message .bubble { position: relative; }
.message.other .bubble::before {
  content: ""; position: absolute; left: -6px; top: 12px; width: 0; height: 0;
  border-top: 6px solid transparent; border-bottom: 6px solid transparent;
  border-right: 6px solid #f4f5f7; filter: drop-shadow(0 1px 0 rgba(0,0,0,.06));
}
.message.me .bubble::after {
  content: ""; position: absolute; right: -6px; top: 12px; width: 0; height: 0;
  border-top: 6px solid transparent; border-bottom: 6px solid transparent;
  border-left: 6px solid #e8f0ff; filter: drop-shadow(0 1px 0 rgba(0,0,0,.06));
}
/* 让消息区更贴近参考界面视觉 */
.message-list { background: linear-gradient(180deg, #fafbfc 0%, #ffffff 60%); }
.message { margin: 10px 0; }
/* 侧栏交互优化 */
.contact-item { transition: background .15s ease, transform .08s ease; }
.contact-item:hover { background: #eef2f7; }
.contact-item.active { background: #e8f0ff; box-shadow: inset 0 0 0 1px #dbeafe; }
/* 当前用户高亮与徽标 */
.contact-item.me { font-weight: 600; }
.contact-item.me .avatar { box-shadow: 0 0 0 2px #c7d2fe; }
.me-badge { margin-left: 6px; display: inline-block; padding: 0 6px; line-height: 18px; font-size: 12px; border-radius: 9px; background: var(--primary); color: #fff; }
/* 输入行与工具栏微调 */
.chat-input { padding: 14px; }
.input-row { gap: 10px; }
/* 小屏优化：保持尾巴尺寸与位置 */
@media (max-width: 520px) {
  .message.other .bubble::before { left: -5px; top: 10px; border-right-color: #f4f5f7; }
  .message.me .bubble::after { right: -5px; top: 10px; border-left-color: #e8f0ff; }
}

/* ---- 新增：emoji 面板样式 ---- */
.emoji-panel { display: none; grid-template-columns: repeat(12, 1fr); gap: 6px; padding: 10px; margin-top: 8px; border: 1px solid var(--border); border-radius: 10px; background: #fafbfc; max-height: 180px; overflow-y: auto; position: relative; z-index: 10; }
.emoji-panel.open { display: grid; }
.emoji-btn { padding: 6px 8px; font-size: 18px; line-height: 1; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; }
.emoji-btn:hover { background: #eef2f7; }
.emoji-btn:active { transform: translateY(1px); }

/* 天气卡片样式 */
.weather-card { display: grid; grid-template-columns: 1fr auto; gap: 8px 16px; max-width: 520px; }
.weather-card .weather-header { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: baseline; }
.weather-card .city { font-weight: 700; font-size: 18px; color: #111827; }
.weather-card .cond { color: #374151; }
.weather-card .weather-main { display: flex; align-items: baseline; gap: 10px; }
.weather-card .temp { font-size: 22px; font-weight: 700; }
.weather-card .range { color: #6b7280; }
.weather-card .weather-extra { grid-column: 1 / -1; display: flex; flex-wrap: wrap; gap: 8px 12px; color: #6b7280; }
.weather-card .weather-tips { grid-column: 1 / -1; color: #0f766e; background: #ecfeff; border: 1px solid #a5f3fc; padding: 8px 10px; border-radius: 8px; }
.weather-card .weather-update { grid-column: 1 / -1; color: #9ca3af; font-size: 12px; }
.music-card { display: flex; gap: 12px; align-items: center; max-width: 520px; }
.music-cover { width: 64px; height: 64px; border-radius: 8px; overflow: hidden; background: #f2f4f7; flex-shrink: 0; }
.music-cover img { width: 100%; height: 100%; object-fit: cover; display: block; }
.music-info { display: flex; flex-direction: column; gap: 6px; }
.music-title { font-weight: 600; color: #111827; }
.music-player { width: 320px; max-width: 60vw; }